<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain-Op | Entrenamiento Estrat茅gico</title>
    <!-- Tailwind CSS para el dise帽o -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React y ReactDOM via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel para compilar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
        }

        .animate-pulse-slow { 
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; 
        }

        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: .7; } 
        }

        .lucide-icon-wrapper i { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }

        .custom-shadow {
            box-shadow: 0 10px 30px -5px rgba(79, 70, 229, 0.1), 0 4px 10px -5px rgba(79, 70, 229, 0.05);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        /* Prevenir que se vea blanco antes de cargar */
        #root:empty {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #4f46e5;
            color: white;
            font-weight: bold;
        }
        #root:empty::after {
            content: "CARGANDO BRAIN-OP...";
            letter-spacing: 0.2em;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useCallback, useRef } = React;
        
        // --- CONFIGURACIN DE FIREBASE ---
        const firebaseConfig = window.__firebase_config ? JSON.parse(window.__firebase_config) : {
            apiKey: "",
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: ""
        };

        const isConfigured = firebaseConfig.apiKey && firebaseConfig.apiKey !== "";

        // Importaciones de m贸dulos Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Inicializaci贸n segura
        let app, auth, db;
        if (isConfigured) {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        }
        
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'brain-op-prod';

        // --- ICONOS ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
                    iconRef.current.innerHTML = `<i data-lucide="${kebabName}"></i>`;
                    window.lucide.createIcons({
                        attrs: { 'stroke-width': 2.5, width: size, height: size, class: className, stroke: 'currentColor' }
                    });
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="lucide-icon-wrapper inline-flex items-center justify-center leading-none"></span>;
        };

        const GAMES = { LOGIN: 'login', MENU: 'menu', CALCULO: 'calculo', ATENCION: 'atencion', MEMORIA: 'memoria', RANKING: 'ranking' };

        const App = () => {
            const [user, setUser] = useState(null);
            const [profile, setProfile] = useState(null);
            const [view, setView] = useState('loading');
            const [score, setScore] = useState(0);
            const [gameState, setGameState] = useState('idle');
            const [timeLeft, setTimeLeft] = useState(30);
            const [ranking, setRanking] = useState([]);

            const [math, setMath] = useState({ q: '', isCorrect: true, displayA: 0 });
            const [attention, setAttention] = useState([]);
            const [sequence, setSequence] = useState([]);
            const [userSeq, setUserSeq] = useState([]);

            const memorySteps = [
                { id: 'MessageSquare', label: 'Saludo' },
                { id: 'Target', label: 'Indagaci贸n' },
                { id: 'Brain', label: 'Empat铆a' },
                { id: 'Award', label: 'Propuesta' },
                { id: 'Check', label: 'Cierre' }
            ];

            // MANDATORY RULE 3: Auth FIRST before any query
            useEffect(() => {
                if (!isConfigured) {
                    setTimeout(() => setView('no-config'), 1000);
                    return;
                }

                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Auth init error", error);
                        setView('no-config');
                    }
                };
                initAuth();

                const unsubscribe = onAuthStateChanged(auth, (firebaseUser) => {
                    if (firebaseUser) {
                        setUser(firebaseUser);
                    }
                });
                return () => unsubscribe();
            }, []);

            // Handle Profile Fetch once Auth is confirmed
            useEffect(() => {
                if (!user) return;

                const fetchProfile = async () => {
                    try {
                        const userDocRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'users', user.uid);
                        const snap = await getDoc(userDocRef);
                        if (snap.exists()) {
                            setProfile(snap.data());
                            setView(GAMES.MENU);
                        } else {
                            setView(GAMES.LOGIN);
                        }
                    } catch (err) {
                        console.error("Error fetching profile:", err);
                        setView(GAMES.LOGIN);
                    }
                };

                fetchProfile();
            }, [user]);

            // MANDATORY RULE 2: Fetch ranking in memory (simple collection query)
            useEffect(() => {
                if (!user || !db || (view !== GAMES.RANKING && view !== GAMES.MENU)) return;

                const usersCollection = collection(db, 'artifacts', APP_ID, 'public', 'data', 'users');
                
                const unsubscribe = onSnapshot(usersCollection, (snap) => {
                    const data = snap.docs.map(d => d.data())
                        .sort((a, b) => (b.totalPoints || 0) - (a.totalPoints || 0));
                    setRanking(data);
                }, (err) => {
                    // Fail silently but log for debug
                    console.error("Ranking snapshot permission or query error:", err);
                });

                return () => unsubscribe();
            }, [user, view]);

            const handleRegister = async (e) => {
                e.preventDefault();
                if (!user || !db) return;
                
                const data = {
                    uid: user.uid,
                    name: e.target.name.value,
                    university: e.target.uni.value,
                    totalPoints: 0,
                    highScore: 0,
                    lastActive: new Date().toISOString()
                };

                try {
                    // RULE 1: Strict Paths
                    const userRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'users', user.uid);
                    await setDoc(userRef, data);
                    setProfile(data);
                    setView(GAMES.MENU);
                } catch (err) {
                    console.error("Error registering user:", err);
                }
            };

            const saveScore = async (finalScore) => {
                if (!user || !profile || !db || finalScore <= 0) return;
                
                const ref = doc(db, 'artifacts', APP_ID, 'public', 'data', 'users', user.uid);
                try {
                    await updateDoc(ref, {
                        totalPoints: increment(finalScore),
                        highScore: Math.max(profile.highScore || 0, finalScore)
                    });
                    // Refresh local profile for UI
                    setProfile(prev => ({
                        ...prev,
                        totalPoints: (prev.totalPoints || 0) + finalScore,
                        highScore: Math.max(prev.highScore || 0, finalScore)
                    }));
                } catch (err) {
                    console.error("Error updating score:", err);
                }
            };

            // Game Logic
            const genMath = useCallback(() => {
                const b = Math.floor(Math.random() * 9 + 1) * 100;
                const d = [10, 20, 25, 50][Math.floor(Math.random() * 4)];
                const c = b - (b * (d / 100));
                const corr = Math.random() > 0.5;
                setMath({ q: `$${b} con ${d}% Beca`, isCorrect: corr, displayA: corr ? c : c + 10 });
            }, []);

            const genAttention = useCallback(() => {
                const icons = ['GraduationCap', 'Target', 'Brain', 'Zap', 'Award'];
                const m = icons[Math.floor(Math.random() * icons.length)];
                let o = icons[Math.floor(Math.random() * icons.length)];
                while(o === m) o = icons[Math.floor(Math.random() * icons.length)];
                const p = Math.floor(Math.random() * 16);
                setAttention(Array(16).fill(null).map((_, i) => ({ id: i, icon: i === p ? o : m, isOdd: i === p })));
            }, []);

            const genSeq = useCallback(() => {
                const icons = ['MessageSquare', 'Target', 'Brain', 'Award', 'Check'];
                const s = Array(3).fill(null).map(() => icons[Math.floor(Math.random() * icons.length)]);
                setSequence(s);
                setUserSeq([]);
                setGameState('memorizing');
                setTimeout(() => setGameState('playing'), 2000);
            }, []);

            useEffect(() => {
                let t;
                if (gameState === 'playing' && timeLeft > 0) t = setInterval(() => setTimeLeft(p => p - 1), 1000);
                else if (timeLeft === 0 && gameState === 'playing') {
                    setGameState('finished');
                    saveScore(score);
                }
                return () => clearInterval(t);
            }, [gameState, timeLeft, score]);

            const start = (g) => {
                setScore(0); 
                setTimeLeft(30); 
                setView(g);
                if (g === GAMES.CALCULO) { setGameState('playing'); genMath(); }
                if (g === GAMES.ATENCION) { setGameState('playing'); genAttention(); }
                if (g === GAMES.MEMORIA) { genSeq(); }
            };

            const restartGame = () => {
                setScore(0);
                setTimeLeft(30);
                if (view === GAMES.CALCULO) genMath();
                if (view === GAMES.ATENCION) genAttention();
                if (view === GAMES.MEMORIA) genSeq();
                setGameState('playing');
            };

            const exitToMenu = () => {
                setGameState('idle');
                setView(GAMES.MENU);
            };

            // --- UI Renders ---

            if (view === 'no-config') return (
                <div className="h-screen flex flex-col items-center justify-center p-8 text-center bg-slate-50">
                    <div className="p-6 bg-red-100 text-red-600 rounded-full mb-6">
                        <Icon name="ShieldAlert" size={60} />
                    </div>
                    <h2 className="text-2xl font-black text-slate-800 mb-4 tracking-tight">Falta Configuraci贸n</h2>
                    <p className="text-slate-500 max-w-xs mb-8">Aseg煤rate de haber configurado las credenciales de Firebase correctamente en el archivo HTML.</p>
                </div>
            );

            if (view === 'loading') return (
                <div className="h-screen flex flex-col items-center justify-center bg-indigo-600 text-white">
                    <Icon name="Brain" size={64} className="animate-bounce mb-6" />
                    <p className="font-bold tracking-[0.2em] animate-pulse text-sm uppercase">Preparando Estrategia...</p>
                </div>
            );

            if (view === GAMES.LOGIN) return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-slate-50">
                    <div className="w-full max-w-md bg-white p-10 rounded-[3rem] shadow-xl border border-indigo-50 animate-in zoom-in duration-500">
                        <div className="flex justify-center mb-8">
                            <div className="p-5 bg-indigo-600 rounded-3xl text-white shadow-xl shadow-indigo-100">
                                <Icon name="Brain" size={48} />
                            </div>
                        </div>
                        <h1 className="text-4xl font-black text-center text-slate-800 mb-2 tracking-tight italic">Brain-Op</h1>
                        <p className="text-center text-slate-500 mb-10 text-sm font-medium">Entrenamiento para equipos USAM y Poli.</p>
                        <form onSubmit={handleRegister} className="space-y-5">
                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase ml-2 mb-2 block tracking-widest">Nombre Completo</label>
                                <input name="name" required className="w-full px-6 py-4 bg-slate-50 border-2 border-transparent focus:border-indigo-500 focus:bg-white rounded-2xl outline-none font-semibold transition-all shadow-inner" placeholder="Ej. Ana Milena" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase ml-2 mb-2 block tracking-widest">Instituci贸n</label>
                                <select name="uni" className="w-full px-6 py-4 bg-slate-50 border-2 border-transparent focus:border-indigo-500 focus:bg-white rounded-2xl outline-none font-semibold appearance-none cursor-pointer shadow-inner">
                                    <option value="Poli">Polit茅cnico Grancolombiano</option>
                                    <option value="USAM">Universidad San Marcos</option>
                                </select>
                            </div>
                            <button className="w-full py-5 bg-indigo-600 text-white rounded-2xl font-bold text-lg shadow-xl shadow-indigo-100 hover:bg-indigo-700 active:scale-95 transition-all mt-6">Empezar a Entrenar</button>
                        </form>
                    </div>
                </div>
            );

            return (
                <div className="max-w-md mx-auto min-h-screen bg-slate-50 flex flex-col shadow-2xl relative overflow-hidden">
                    {/* Header */}
                    <div className="bg-white/80 backdrop-blur-md p-5 border-b flex justify-between items-center sticky top-0 z-40">
                        <div className="flex items-center gap-3">
                            <div className="w-11 h-11 bg-indigo-600 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg border-2 border-indigo-100">
                                {profile?.name?.[0] || 'U'}
                            </div>
                            <div>
                                <p className="text-[10px] font-extrabold text-indigo-600 uppercase tracking-tighter leading-none">{profile?.university}</p>
                                <p className="font-bold text-slate-800 text-sm leading-tight truncate max-w-[140px]">{profile?.name}</p>
                            </div>
                        </div>
                        <div className="bg-amber-100 px-4 py-2 rounded-2xl border border-amber-200 flex items-center gap-2 shadow-sm">
                            <Icon name="Zap" size={18} className="text-amber-500 fill-amber-500" />
                            <span className="font-black text-amber-700 text-sm">{profile?.totalPoints || 0}</span>
                        </div>
                    </div>

                    <main className="flex-1 overflow-y-auto p-6 pb-28">
                        {view === GAMES.MENU && (
                            <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <div className="bg-gradient-to-br from-indigo-600 to-indigo-800 p-8 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden">
                                    <div className="relative z-10">
                                        <h2 className="text-2xl font-bold mb-1 italic">Entrenamiento Diario</h2>
                                        <p className="text-indigo-100 text-sm mb-8 font-medium opacity-90">Mejora tus habilidades en la operaci贸n.</p>
                                        <div className="flex gap-3">
                                            <div className="flex-1 glass-card p-4 rounded-3xl border border-white/20 shadow-lg">
                                                <p className="text-[10px] uppercase font-black opacity-60 mb-1 tracking-wider">R茅cord</p>
                                                <p className="font-black text-lg">{profile?.highScore || 0} <span className="text-[10px] font-bold">PTS</span></p>
                                            </div>
                                            <div className="flex-1 glass-card p-4 rounded-3xl border border-white/20 shadow-lg">
                                                <p className="text-[10px] uppercase font-black opacity-60 mb-1 tracking-wider">Estatus</p>
                                                <p className="font-black text-lg">Activo </p>
                                            </div>
                                        </div>
                                    </div>
                                    <Icon name="Brain" size={150} className="absolute -right-10 -bottom-10 opacity-10" />
                                </div>

                                <div className="space-y-4">
                                    <h3 className="text-xs font-black text-slate-400 uppercase tracking-[0.2em] ml-2">M贸dulos de Agilidad</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <button onClick={() => start(GAMES.CALCULO)} className="p-6 bg-white rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl hover:border-amber-200 transition-all text-left group">
                                            <div className="w-12 h-12 bg-amber-50 text-amber-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-sm"><Icon name="Zap" size={24} /></div>
                                            <h4 className="font-extrabold text-slate-800 text-sm mb-1">Auditor铆a</h4>
                                            <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Becas y c谩lculos</p>
                                        </button>
                                        <button onClick={() => start(GAMES.ATENCION)} className="p-6 bg-white rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl hover:border-blue-200 transition-all text-left group">
                                            <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-sm"><Icon name="Target" size={24} /></div>
                                            <h4 className="font-extrabold text-slate-800 text-sm mb-1">Detalle</h4>
                                            <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Atenci贸n visual</p>
                                        </button>
                                        <button onClick={() => start(GAMES.MEMORIA)} className="p-6 bg-white rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl hover:border-purple-200 transition-all text-left group">
                                            <div className="w-12 h-12 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-sm"><Icon name="BookOpen" size={24} /></div>
                                            <h4 className="font-extrabold text-slate-800 text-sm mb-1">Ruta Venta</h4>
                                            <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Secuencia l贸gica</p>
                                        </button>
                                        <button onClick={() => setView(GAMES.RANKING)} className="p-6 bg-white rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl hover:border-green-200 transition-all text-left group">
                                            <div className="w-12 h-12 bg-green-50 text-green-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-sm"><Icon name="Users" size={24} /></div>
                                            <h4 className="font-extrabold text-slate-800 text-sm mb-1">Ranking</h4>
                                            <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">L铆deres Operaci贸n</p>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === GAMES.RANKING && (
                            <div className="animate-in slide-in-from-right duration-300">
                                <div className="flex items-center gap-4 mb-8">
                                    <button onClick={() => setView(GAMES.MENU)} className="p-3 bg-white hover:bg-slate-100 rounded-2xl transition-all shadow-sm"><Icon name="ArrowLeft" size={24} /></button>
                                    <h2 className="font-black text-2xl text-slate-800 tracking-tight italic">Top Estrategas</h2>
                                </div>
                                <div className="space-y-4">
                                    {ranking.length === 0 ? (
                                        <div className="text-center p-12 text-slate-400 italic font-medium">Cargando clasificaci贸n...</div>
                                    ) : ranking.map((p, i) => (
                                        <div key={p.uid || i} className={`flex items-center p-6 rounded-[2.5rem] border-2 transition-all shadow-sm ${p.uid === user?.uid ? 'bg-indigo-50 border-indigo-200 shadow-inner' : 'bg-white border-slate-100'}`}>
                                            <span className={`w-12 font-black text-xl ${i<3 ? 'text-amber-500' : 'text-slate-200'}`}>#{i+1}</span>
                                            <div className="flex-1">
                                                <p className="font-bold text-slate-800 text-base leading-tight">{p.name}</p>
                                                <p className="text-[11px] text-slate-400 font-black uppercase tracking-widest">{p.university}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="font-black text-indigo-600 text-2xl leading-none">{p.totalPoints || 0}</p>
                                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">Pts</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Game Views */}
                        {(view === GAMES.CALCULO || view === GAMES.ATENCION || view === GAMES.MEMORIA) && gameState !== 'finished' && (
                            <div className="h-full flex flex-col animate-in zoom-in duration-300">
                                <div className="flex justify-between items-center mb-8 bg-white p-4 rounded-[2rem] shadow-sm border border-slate-100">
                                    <div className="flex items-center gap-2 px-2">
                                        <button onClick={exitToMenu} className="p-2 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded-xl transition-all" title="Salir">
                                            <Icon name="X" size={20} />
                                        </button>
                                        <button onClick={restartGame} className="p-2 hover:bg-amber-50 text-slate-400 hover:text-amber-500 rounded-xl transition-all" title="Reiniciar">
                                            <Icon name="RotateCcw" size={20} />
                                        </button>
                                    </div>
                                    <div className="flex flex-col items-center">
                                        <span className="font-black text-slate-800 text-lg leading-none tracking-tight">{score}</span>
                                        <span className="text-[9px] font-black text-slate-400 uppercase tracking-widest">Puntos</span>
                                    </div>
                                    <div className={`px-5 py-2 rounded-2xl text-sm font-black text-white transition-all duration-500 shadow-sm ${timeLeft < 10 ? 'bg-red-500 animate-pulse' : 'bg-slate-800'}`}>
                                        {timeLeft}s
                                    </div>
                                </div>

                                {view === GAMES.CALCULO && (
                                    <div className="flex-1 flex flex-col justify-center">
                                        <div className="bg-white p-12 rounded-[4rem] shadow-xl border border-slate-100 text-center mb-10 transform transition-transform">
                                            <p className="text-[11px] text-slate-400 font-black uppercase tracking-[0.3em] mb-4 italic">驴Es Correcta la Beca?</p>
                                            <h3 className="text-xl font-bold text-slate-600 mb-2">{math.q}</h3>
                                            <div className="text-6xl font-black text-indigo-600 tracking-tighter">${math.displayA}</div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-6">
                                            <button onClick={() => { if(!math.isCorrect) setScore(s=>s+10); else setScore(s=>Math.max(0, s-5)); genMath(); }} className="py-10 bg-white border-2 border-red-50 text-red-500 rounded-[3rem] shadow-md active:scale-95 transition-all flex justify-center items-center hover:bg-red-50 hover:border-red-200"><Icon name="X" size={56} /></button>
                                            <button onClick={() => { if(math.isCorrect) setScore(s=>s+10); else setScore(s=>Math.max(0, s-5)); genMath(); }} className="py-10 bg-white border-2 border-green-50 text-green-500 rounded-[3rem] shadow-md active:scale-95 transition-all flex justify-center items-center hover:bg-green-50 hover:border-green-200"><Icon name="Check" size={56} /></button>
                                        </div>
                                    </div>
                                )}

                                {view === GAMES.ATENCION && (
                                    <div className="flex-1 flex flex-col justify-center">
                                        <p className="text-center text-slate-400 text-[11px] font-black uppercase mb-8 tracking-[0.2em] italic">Encuentra el elemento intruso</p>
                                        <div className="grid grid-cols-4 gap-4 p-5 bg-white rounded-[3rem] shadow-xl border border-slate-100">
                                            {attention.map(item => (
                                                <button key={item.id} onClick={() => { if(item.isOdd) { setScore(s=>s+15); genAttention(); } else setScore(s=>Math.max(0, s-10)); }} className="aspect-square flex items-center justify-center p-3 rounded-3xl bg-slate-50 text-slate-300 hover:bg-indigo-50 hover:text-indigo-600 transition-all active:scale-90 border-2 border-transparent hover:border-indigo-100 shadow-sm">
                                                    <Icon name={item.icon} size={32} />
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {view === GAMES.MEMORIA && (
                                    <div className="flex-1 flex flex-col justify-center">
                                        {gameState === 'memorizing' ? (
                                            <div className="text-center animate-pulse-slow">
                                                <p className="text-purple-600 font-black uppercase mb-10 tracking-[0.3em]">Memoriza la Secuencia</p>
                                                <div className="flex gap-4 justify-center">
                                                    {sequence.map((iconName, i) => (
                                                        <div key={i} className="p-7 bg-white text-purple-600 rounded-[2.5rem] shadow-xl border-2 border-purple-100">
                                                            <Icon name={iconName} size={48} />
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="space-y-10 animate-in fade-in duration-300">
                                                <p className="text-center text-slate-400 text-[11px] font-black uppercase tracking-[0.2em]">Repite la ruta operativa</p>
                                                <div className="grid grid-cols-3 gap-4">
                                                    {memorySteps.map((step) => (
                                                        <button key={step.id} onClick={() => {
                                                            const next = userSeq.length;
                                                            if (step.id === sequence[next]) {
                                                                const n = [...userSeq, step.id];
                                                                setUserSeq(n);
                                                                if(n.length === sequence.length) { setScore(s=>s+25); genSeq(); }
                                                            } else { 
                                                                setScore(s=>Math.max(0, s-10)); 
                                                                genSeq(); 
                                                            }
                                                        }} className="p-8 bg-white rounded-[2.5rem] border border-slate-100 shadow-sm flex flex-col items-center gap-3 hover:border-purple-300 hover:bg-purple-50 transition-all active:scale-95 group">
                                                            <Icon name={step.id} size={32} className="text-slate-400 group-hover:text-purple-600" />
                                                            <span className="text-[10px] font-black uppercase text-slate-400 group-hover:text-purple-600 tracking-tight">{step.label}</span>
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}

                        {gameState === 'finished' && (
                            <div className="h-full flex flex-col items-center justify-center text-center p-8 animate-in zoom-in duration-500">
                                <div className="p-12 bg-amber-100 text-amber-600 rounded-full mb-10 shadow-2xl relative">
                                    <Icon name="Trophy" size={100} />
                                    <div className="absolute -top-2 -right-2 w-10 h-10 bg-indigo-600 rounded-full border-4 border-white flex items-center justify-center shadow-lg">
                                        <Icon name="Check" size={20} className="text-white" />
                                    </div>
                                </div>
                                <h2 className="text-4xl font-black text-slate-800 mb-3 tracking-tight italic uppercase">隆Reto Completado!</h2>
                                <p className="text-slate-500 mb-12 text-lg font-medium">Sumaste <span className="text-indigo-600 font-black px-3 py-1 bg-indigo-50 rounded-xl">{score}</span> puntos.</p>
                                <div className="w-full space-y-4">
                                    <button onClick={restartGame} className="w-full py-5 bg-indigo-600 text-white rounded-[2rem] font-bold text-xl shadow-xl hover:bg-indigo-700 active:scale-95 transition-all">Reintentar Ahora</button>
                                    <button onClick={exitToMenu} className="w-full py-5 bg-white text-slate-400 rounded-[2rem] font-bold text-lg hover:text-slate-600 transition-all">Volver al Men煤</button>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Bottom Nav */}
                    {view === GAMES.MENU && (
                        <nav className="absolute bottom-0 w-full bg-white/90 backdrop-blur-md border-t p-6 flex justify-around items-center rounded-t-[3rem] shadow-[0_-20px_60px_-15px_rgba(79,70,229,0.15)]">
                            <button className="text-indigo-600 flex flex-col items-center gap-1.5 transition-transform hover:scale-110">
                                <Icon name="Brain" size={28}/><span className="text-[10px] font-black tracking-widest uppercase">Entrenar</span>
                            </button>
                            <button onClick={() => setView(GAMES.RANKING)} className="text-slate-300 flex flex-col items-center gap-1.5 hover:text-indigo-400 transition-all hover:scale-110">
                                <Icon name="TrendingUp" size={28}/><span className="text-[10px] font-black tracking-widest uppercase">Ranking</span>
                            </button>
                            <button onClick={() => window.location.reload()} className="text-slate-300 flex flex-col items-center gap-1.5 hover:text-red-400 transition-all hover:scale-110">
                                <Icon name="LogOut" size={28}/><span className="text-[10px] font-black tracking-widest uppercase">Salir</span>
                            </button>
                        </nav>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
