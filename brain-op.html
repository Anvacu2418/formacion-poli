<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain-Op | Entrenamiento Estrat√©gico</title>
    <!-- Tailwind CSS para el dise√±o -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React y ReactDOM via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel para compilar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        .animate-pulse-slow { 
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; 
        }

        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: .7; } 
        }

        .lucide-icon-wrapper i { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }

        .custom-shadow {
            box-shadow: 0 10px 30px -5px rgba(79, 70, 229, 0.1), 0 4px 10px -5px rgba(79, 70, 229, 0.05);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useCallback, useRef } = React;
        
        // --- ‚úÖ CONFIGURACI√ìN DE FIREBASE ANGIE VANESSA ‚úÖ ---
        const myFirebaseConfig = {
            apiKey: "AIzaSyAgEw68vOmqBC0vm8zFGNVyRpEtNCGl0Wk",
            authDomain: "brain-op.firebaseapp.com",
            projectId: "brain-op",
            storageBucket: "brain-op.firebasestorage.app",
            messagingSenderId: "193463235722",
            appId: "1:193463235722:web:858216dfc63eb1af4e6973",
            measurementId: "G-XQY9TETKTQ"
        };

        const isConfigured = myFirebaseConfig.apiKey !== "";
        const firebaseConfig = (window.__firebase_config && !isConfigured) 
            ? JSON.parse(window.__firebase_config) 
            : myFirebaseConfig;

        // Importaciones de m√≥dulos Firebase (v√≠a CDN din√°mico)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        let app, auth, db;
        if (firebaseConfig.apiKey) {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        }

        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'brain-op-prod';

        // --- COMPONENTE DE ICONOS ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
                    iconRef.current.innerHTML = `<i data-lucide="${kebabName}"></i>`;
                    window.lucide.createIcons({
                        attrs: { 'stroke-width': 2.5, width: size, height: size, class: className, stroke: 'currentColor' }
                    });
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="lucide-icon-wrapper inline-flex items-center justify-center leading-none"></span>;
        };

        const GAMES = { LOGIN: 'login', MENU: 'menu', CALCULO: 'calculo', ATENCION: 'atencion', MEMORIA: 'memoria', RANKING: 'ranking', ERROR: 'error' };

        const App = () => {
            const [user, setUser] = useState(null);
            const [profile, setProfile] = useState(null);
            const [view, setView] = useState('loading');
            const [score, setScore] = useState(0);
            const [gameState, setGameState] = useState('idle');
            const [timeLeft, setTimeLeft] = useState(30);
            const [ranking, setRanking] = useState([]);
            const [errorDetail, setErrorDetail] = useState("");

            const [math, setMath] = useState({ q: '', isCorrect: true, displayA: 0 });
            const [attention, setAttention] = useState([]);
            const [sequence, setSequence] = useState([]);
            const [userSeq, setUserSeq] = useState([]);

            const memorySteps = [
                { id: 'MessageSquare', label: 'Saludo' },
                { id: 'Target', label: 'Indagaci√≥n' },
                { id: 'Brain', label: 'Empat√≠a' },
                { id: 'Award', label: 'Propuesta' },
                { id: 'Check', label: 'Cierre' }
            ];

            // Auth Initialization
            useEffect(() => {
                const initAuth = async () => {
                    try {
                        // Forzamos un retraso para asegurar carga completa
                        await new Promise(resolve => setTimeout(resolve, 1000));

                        const unsubscribe = onAuthStateChanged(auth, async (u) => {
                            if (u) {
                                setUser(u);
                                try {
                                    const userDocRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'users', u.uid);
                                    const snap = await getDoc(userDocRef);
                                    if (snap.exists()) {
                                        setProfile(snap.data());
                                        setView(GAMES.MENU);
                                    } else {
                                        setView(GAMES.LOGIN);
                                    }
                                } catch (err) {
                                    setView(GAMES.LOGIN);
                                }
                            } else {
                                // Intentar login an√≥nimo si no hay usuario
                                try {
                                    await signInAnonymously(auth);
                                } catch (e) {
                                    setErrorDetail(e.code);
                                    setView(GAMES.ERROR);
                                }
                            }
                        });

                        return unsubscribe;
                    } catch (error) {
                        setErrorDetail(error.message);
                        setView(GAMES.ERROR);
                    }
                };
                if (firebaseConfig.apiKey) initAuth();
            }, []);

            // Ranking Real-time
            useEffect(() => {
                if (!user || (view !== GAMES.RANKING && view !== GAMES.MENU)) return;
                const unsubscribe = onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'users'), 
                (snap) => {
                    const data = snap.docs.map(d => d.data()).sort((a, b) => (b.totalPoints || 0) - (a.totalPoints || 0));
                    setRanking(data);
                });
                return () => unsubscribe();
            }, [user, view]);

            const handleRegister = async (e) => {
                e.preventDefault();
                if (!user) return;
                const data = { 
                    uid: user.uid, 
                    name: e.target.name.value, 
                    university: e.target.uni.value, 
                    totalPoints: 0, 
                    highScore: 0, 
                    lastActive: new Date().toISOString() 
                };
                try {
                    await setDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'users', user.uid), data);
                    setProfile(data);
                    setView(GAMES.MENU);
                } catch (err) {
                    alert("Error: Activa 'Firestore Database' en tu consola.");
                }
            };

            const saveScore = async (finalScore) => {
                if (!user || !profile || finalScore <= 0) return;
                const ref = doc(db, 'artifacts', APP_ID, 'public', 'data', 'users', user.uid);
                try {
                    await updateDoc(ref, { 
                        totalPoints: increment(finalScore), 
                        highScore: Math.max(profile.highScore || 0, finalScore) 
                    });
                    setProfile(prev => ({
                        ...prev,
                        totalPoints: (prev.totalPoints || 0) + finalScore,
                        highScore: Math.max(prev.highScore || 0, finalScore)
                    }));
                } catch (e) {
                    console.error("Save score error:", e);
                }
            };

            const genMath = useCallback(() => {
                const b = Math.floor(Math.random() * 9 + 1) * 100;
                const d = [10, 20, 25, 50][Math.floor(Math.random() * 4)];
                const c = b - (b * (d / 100));
                const corr = Math.random() > 0.5;
                setMath({ q: `$${b} con ${d}% Beca`, isCorrect: corr, displayA: corr ? c : c + 10 });
            }, []);

            const genAttention = useCallback(() => {
                const icons = ['GraduationCap', 'Target', 'Brain', 'Zap', 'Award'];
                const m = icons[Math.floor(Math.random() * icons.length)];
                let o = icons[Math.floor(Math.random() * icons.length)];
                while(o === m) o = icons[Math.floor(Math.random() * icons.length)];
                const p = Math.floor(Math.random() * 16);
                setAttention(Array(16).fill(null).map((_, i) => ({ id: i, icon: i === p ? o : m, isOdd: i === p })));
            }, []);

            const genSeq = useCallback(() => {
                const icons = ['MessageSquare', 'Target', 'Brain', 'Award', 'Check'];
                const s = Array(3).fill(null).map(() => icons[Math.floor(Math.random() * icons.length)]);
                setSequence(s);
                setUserSeq([]);
                setGameState('memorizing');
                setTimeout(() => setGameState('playing'), 2000);
            }, []);

            useEffect(() => {
                let t;
                if (gameState === 'playing' && timeLeft > 0) t = setInterval(() => setTimeLeft(p => p - 1), 1000);
                else if (timeLeft === 0 && gameState === 'playing') {
                    setGameState('finished');
                    saveScore(score);
                }
                return () => clearInterval(t);
            }, [gameState, timeLeft, score, profile]);

            const start = (g) => {
                setScore(0); setTimeLeft(30); setView(g);
                if (g === GAMES.CALCULO) { setGameState('playing'); genMath(); }
                if (g === GAMES.ATENCION) { setGameState('playing'); genAttention(); }
                if (g === GAMES.MEMORIA) { genSeq(); }
            };

            // --- VISTAS ---

            if (view === GAMES.ERROR) return (
                <div className="h-screen flex flex-col items-center justify-center p-8 bg-white text-center">
                    <div className="w-20 h-20 bg-red-50 rounded-3xl flex items-center justify-center mb-6 border-4 border-red-100">
                        <Icon name="ShieldAlert" size={40} className="text-red-500" />
                    </div>
                    <h2 className="text-2xl font-black text-slate-800 tracking-tight">Acceso Restringido</h2>
                    <div className="bg-slate-50 p-6 rounded-3xl mt-4 mb-8 text-sm text-slate-600 text-left border border-slate-100 max-w-sm">
                        <p className="font-bold text-slate-800 mb-2 underline italic">Soluci√≥n en segundos:</p>
                        <ol className="list-decimal ml-4 space-y-2">
                            <li>En Firebase, ve a la pesta√±a <b>M√©todo de acceso</b>.</li>
                            <li>Dale a <b>Agregar nuevo proveedor</b>.</li>
                            <li>Busca <b>An√≥nimo</b>, act√≠valo y dale a <b>Guardar</b>.</li>
                        </ol>
                    </div>
                    <button onClick={() => window.location.reload()} className="w-full max-w-xs py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-xl active:scale-95 transition-all">Ya lo activ√©, entrar ahora</button>
                </div>
            );

            if (view === 'loading') return (
                <div className="h-screen flex flex-col items-center justify-center bg-indigo-600 text-white">
                    <Icon name="Brain" size={80} className="animate-bounce mb-6" />
                    <p className="font-bold tracking-[0.3em] animate-pulse text-sm uppercase">Iniciando Brain-Op...</p>
                </div>
            );

            if (view === GAMES.LOGIN) return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-slate-50 text-center">
                    <div className="w-full max-w-md bg-white p-10 rounded-[3rem] shadow-xl border border-indigo-50 animate-in zoom-in duration-500">
                        <div className="flex justify-center mb-8">
                            <div className="p-5 bg-indigo-600 rounded-3xl text-white shadow-xl shadow-indigo-100">
                                <Icon name="Brain" size={48} />
                            </div>
                        </div>
                        <h1 className="text-4xl font-black text-center text-slate-800 mb-2 tracking-tight">Brain-Op</h1>
                        <p className="text-slate-500 mb-10 text-sm font-medium">Entrena tu mente para liderar en USAM y Poli.</p>
                        <form onSubmit={handleRegister} className="space-y-5 text-left">
                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase ml-2 mb-2 block tracking-widest text-center">Nombre Completo</label>
                                <input name="name" required className="w-full px-6 py-4 bg-slate-50 border-2 border-transparent focus:border-indigo-500 focus:bg-white rounded-2xl outline-none font-semibold transition-all text-center" placeholder="Ej. Ana Milena" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase ml-2 mb-2 block tracking-widest text-center">Instituci√≥n</label>
                                <select name="uni" className="w-full px-6 py-4 bg-slate-50 border-2 border-transparent focus:border-indigo-500 focus:bg-white rounded-2xl outline-none font-semibold appearance-none cursor-pointer text-center">
                                    <option value="Poli">Polit√©cnico Grancolombiano</option>
                                    <option value="USAM">Universidad San Marcos</option>
                                </select>
                            </div>
                            <button className="w-full py-5 bg-indigo-600 text-white rounded-2xl font-bold text-lg shadow-xl shadow-indigo-100 hover:bg-indigo-700 active:scale-95 transition-all mt-6">Empezar a Entrenar</button>
                        </form>
                    </div>
                </div>
            );

            return (
                <div className="max-w-md mx-auto min-h-screen bg-slate-50 flex flex-col shadow-2xl relative overflow-hidden">
                    <div className="bg-white/80 backdrop-blur-md p-5 border-b flex justify-between items-center sticky top-0 z-40">
                        <div className="flex items-center gap-3">
                            <div className="w-11 h-11 bg-indigo-600 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg shadow-indigo-100">
                                {profile?.name?.[0] || 'U'}
                            </div>
                            <div className="min-w-0 text-left">
                                <p className="text-[10px] font-extrabold text-indigo-600 uppercase tracking-tighter leading-none">{profile?.university}</p>
                                <p className="font-bold text-slate-800 text-sm leading-tight truncate max-w-[140px]">{profile?.name || 'Invitado'}</p>
                            </div>
                        </div>
                        <div className="bg-amber-100 px-4 py-2 rounded-2xl border border-amber-200 flex items-center gap-2 shadow-sm">
                            <Icon name="Zap" size={18} className="text-amber-500 fill-amber-500" />
                            <span className="font-black text-amber-700 text-sm">{profile?.totalPoints || 0}</span>
                        </div>
                    </div>

                    <main className="flex-1 overflow-y-auto p-6 pb-28 text-center">
                        {view === GAMES.MENU && (
                            <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <div className="bg-gradient-to-br from-indigo-600 to-indigo-800 p-8 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden text-center">
                                    <div className="relative z-10">
                                        <h2 className="text-2xl font-bold mb-1 italic tracking-tight">¬°Hola de nuevo!</h2>
                                        <p className="text-indigo-100 text-sm mb-8 font-medium opacity-90">Tu entrenamiento estrat√©gico est√° listo.</p>
                                        <div className="flex gap-3">
                                            <div className="flex-1 glass-card p-4 rounded-3xl border border-white/20">
                                                <p className="text-[10px] uppercase font-black opacity-60 mb-1 tracking-wider">R√©cord</p>
                                                <p className="font-black text-lg">{profile?.highScore || 0} <span className="text-[10px] font-bold">PTS</span></p>
                                            </div>
                                            <div className="flex-1 glass-card p-4 rounded-3xl border border-white/20">
                                                <p className="text-[10px] uppercase font-black opacity-60 mb-1 tracking-wider">Estatus</p>
                                                <p className="font-black text-lg">Activo üî•</p>
                                            </div>
                                        </div>
                                    </div>
                                    <Icon name="Brain" size={150} className="absolute -right-10 -bottom-10 opacity-10" />
                                </div>

                                <div className="space-y-4">
                                    <h3 className="text-xs font-black text-slate-400 uppercase tracking-[0.2em] ml-2 text-left">M√≥dulos de Agilidad</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        {[
                                            { id: GAMES.CALCULO, label: 'Auditor√≠a', desc: 'Becas y c√°lculos', color: 'amber', icon: 'Zap' },
                                            { id: GAMES.ATENCION, label: 'Detalle', desc: 'Atenci√≥n visual', color: 'blue', icon: 'Target' },
                                            { id: GAMES.MEMORIA, label: 'Ruta Venta', desc: 'Secuencia l√≥gica', color: 'purple', icon: 'BookOpen' },
                                            { id: GAMES.RANKING, label: 'Ranking', desc: 'L√≠deres Operaci√≥n', color: 'green', icon: 'Users' }
                                        ].map(game => (
                                            <button key={game.id} onClick={() => game.id === GAMES.RANKING ? setView(GAMES.RANKING) : start(game.id)} className={`p-6 bg-white rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all text-left group active:scale-95`}>
                                                <div className={`w-12 h-12 bg-slate-50 text-slate-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform`}>
                                                    <Icon name={game.icon} size={24} />
                                                </div>
                                                <h4 className="font-extrabold text-slate-800 text-sm mb-1">{game.label}</h4>
                                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">{game.desc}</p>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === GAMES.RANKING && (
                            <div className="animate-in slide-in-from-right duration-300">
                                <div className="flex items-center gap-4 mb-8">
                                    <button onClick={() => setView(GAMES.MENU)} className="p-3 bg-white hover:bg-slate-100 rounded-2xl transition-all shadow-sm"><Icon name="ArrowLeft" size={24} /></button>
                                    <h2 className="font-black text-2xl text-slate-800 tracking-tight">Top Estrategas</h2>
                                </div>
                                <div className="space-y-4">
                                    {ranking.map((p, i) => (
                                        <div key={i} className={`flex items-center p-6 rounded-[2.5rem] border-2 transition-all ${p.uid === user?.uid ? 'bg-indigo-50 border-indigo-200 shadow-inner' : 'bg-white border-slate-100 shadow-sm'}`}>
                                            <span className={`w-12 font-black text-xl ${i<3 ? 'text-amber-500' : 'text-slate-200'}`}>#{i+1}</span>
                                            <div className="flex-1 text-left ml-2">
                                                <p className="font-bold text-slate-800 text-base leading-tight">{p.name}</p>
                                                <p className="text-[11px] text-slate-400 font-black uppercase tracking-widest">{p.university}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="font-black text-indigo-600 text-2xl leading-none">{p.totalPoints || 0}</p>
                                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">Pts</p>
                                            </div>
                                        </div>
                                    ))}
                                    {ranking.length === 0 && <p className="text-center text-slate-400 italic mt-20">Esperando a los primeros retadores...</p>}
                                </div>
                            </div>
                        )}

                        {/* Juegos Logic */}
                        {(view === GAMES.CALCULO || view === GAMES.ATENCION || view === GAMES.MEMORIA) && gameState !== 'finished' && (
                            <div className="h-full flex flex-col animate-in zoom-in duration-300">
                                <div className="flex justify-between items-center mb-8 bg-white p-4 rounded-[2rem] shadow-sm border border-slate-100">
                                    <div className="flex items-center gap-2 px-2">
                                        <button onClick={() => setView(GAMES.MENU)} className="p-2 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded-xl transition-all" title="Salir"><Icon name="X" size={20} /></button>
                                        <button onClick={() => start(view)} className="p-2 hover:bg-amber-50 text-slate-400 hover:text-amber-500 rounded-xl transition-all" title="Reiniciar"><Icon name="RotateCcw" size={20} /></button>
                                    </div>
                                    <div className="flex flex-col items-center">
                                        <span className="font-black text-slate-800 text-lg leading-none">{score}</span>
                                        <span className="text-[9px] font-black text-slate-400 uppercase tracking-widest">Puntos</span>
                                    </div>
                                    <div className={`px-5 py-2 rounded-2xl text-sm font-black text-white transition-all duration-500 ${timeLeft < 10 ? 'bg-red-500 animate-pulse' : 'bg-slate-800'}`}>{timeLeft}s</div>
                                </div>

                                {view === GAMES.CALCULO && (
                                    <div className="flex-1 flex flex-col justify-center text-center">
                                        <div className="bg-white p-12 rounded-[4rem] shadow-xl border border-slate-100 mb-10 transform hover:scale-[1.02] transition-transform">
                                            <p className="text-[11px] text-slate-400 font-black uppercase tracking-[0.3em] mb-4 italic">¬øEs Correcta la Beca?</p>
                                            <h3 className="text-xl font-bold text-slate-600 mb-2">{math.q}</h3>
                                            <div className="text-6xl font-black text-indigo-600 tracking-tighter leading-none">${math.displayA}</div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-6">
                                            <button onClick={() => { if(!math.isCorrect) setScore(s=>s+10); else setScore(s=>Math.max(0, s-5)); genMath(); }} className="py-10 bg-white border-2 border-red-50 text-red-500 rounded-[3rem] shadow-sm active:scale-95 transition-all flex justify-center items-center hover:bg-red-50 hover:border-red-200"><Icon name="X" size={56} /></button>
                                            <button onClick={() => { if(math.isCorrect) setScore(s=>s+10); else setScore(s=>Math.max(0, s-5)); genMath(); }} className="py-10 bg-white border-2 border-green-50 text-green-500 rounded-[3rem] shadow-sm active:scale-95 transition-all flex justify-center items-center hover:bg-green-50 hover:border-green-200"><Icon name="Check" size={56} /></button>
                                        </div>
                                    </div>
                                )}

                                {view === GAMES.ATENCION && (
                                    <div className="flex-1 flex flex-col justify-center text-center">
                                        <p className="text-slate-400 text-[11px] font-black uppercase mb-8 tracking-[0.2em] italic">Encuentra el error de proceso</p>
                                        <div className="grid grid-cols-4 gap-4 p-5 bg-white rounded-[3rem] shadow-xl border border-slate-100">
                                            {attention.map(item => (
                                                <button key={item.id} onClick={() => { if(item.isOdd) { setScore(s=>s+15); genAttention(); } else setScore(s=>Math.max(0, s-10)); }} className="aspect-square flex items-center justify-center p-3 rounded-3xl bg-slate-50 text-slate-300 hover:bg-indigo-50 hover:text-indigo-600 transition-all active:scale-90 border-2 border-transparent hover:border-indigo-100"><Icon name={item.icon} size={32} /></button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {view === GAMES.MEMORIA && (
                                    <div className="flex-1 flex flex-col justify-center text-center">
                                        {gameState === 'memorizing' ? (
                                            <div className="animate-pulse-slow">
                                                <p className="text-purple-600 font-black uppercase mb-10 tracking-[0.3em]">Memoriza la Secuencia</p>
                                                <div className="flex gap-4 justify-center">
                                                    {sequence.map((iconName, i) => (<div key={i} className="p-7 bg-white text-purple-600 rounded-[2.5rem] shadow-xl border-2 border-purple-100"><Icon name={iconName} size={48} /></div>))}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="space-y-10 animate-in fade-in duration-300">
                                                <p className="text-slate-400 text-[11px] font-black uppercase tracking-[0.2em]">Repite la ruta operativa</p>
                                                <div className="grid grid-cols-3 gap-4">
                                                    {memorySteps.map((step) => (
                                                        <button key={step.id} onClick={() => {
                                                            const next = userSeq.length;
                                                            if (step.id === sequence[next]) {
                                                                const n = [...userSeq, step.id];
                                                                setUserSeq(n);
                                                                if(n.length === sequence.length) { setScore(s=>s+25); genSeq(); }
                                                            } else { setScore(s=>Math.max(0, s-10)); genSeq(); }
                                                        }} className="p-8 bg-white rounded-[2.5rem] border border-slate-100 shadow-sm flex flex-col items-center gap-3 hover:border-purple-300 hover:bg-purple-50 transition-all active:scale-95 group">
                                                            <Icon name={step.id} size={32} className="text-slate-400 group-hover:text-purple-600" />
                                                            <span className="text-[10px] font-black uppercase text-slate-400 group-hover:text-purple-600 tracking-tight">{step.label}</span>
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}

                        {gameState === 'finished' && (
                            <div className="h-full flex flex-col items-center justify-center text-center p-8 animate-in zoom-in duration-500">
                                <div className="p-12 bg-amber-100 text-amber-600 rounded-full mb-10 shadow-2xl shadow-amber-50 relative">
                                    <Icon name="Trophy" size={100} />
                                    <div className="absolute -top-2 -right-2 w-10 h-10 bg-indigo-600 rounded-full border-4 border-white flex items-center justify-center shadow-lg"><Icon name="Check" size={20} className="text-white" /></div>
                                </div>
                                <h2 className="text-4xl font-black text-slate-800 mb-3 tracking-tight italic uppercase leading-none">¬°Nivel Completado!</h2>
                                <p className="text-slate-500 mb-12 text-lg font-medium">Has sumado <span className="text-indigo-600 font-black px-3 py-1 bg-indigo-50 rounded-xl">{score}</span> puntos a tu perfil.</p>
                                <div className="w-full space-y-4">
                                    <button onClick={() => start(view)} className="w-full py-5 bg-indigo-600 text-white rounded-[2rem] font-bold text-xl shadow-xl shadow-indigo-100 hover:bg-indigo-700 active:scale-95 transition-all">Reintentar Ahora</button>
                                    <button onClick={() => setView(GAMES.MENU)} className="w-full py-5 bg-white text-slate-400 rounded-[2rem] font-bold text-lg hover:text-slate-600 transition-all text-slate-400">Volver al Men√∫</button>
                                </div>
                            </div>
                        )}
                    </main>

                    {view === GAMES.MENU && (
                        <nav className="absolute bottom-0 w-full bg-white/90 backdrop-blur-md border-t p-6 flex justify-around items-center rounded-t-[3rem] shadow-[0_-20px_60px_-15px_rgba(79,70,229,0.15)] text-center">
                            <button className="text-indigo-600 flex flex-col items-center gap-1.5 transition-transform hover:scale-110">
                                <Icon name="Brain" size={28}/><span className="text-[10px] font-black tracking-widest uppercase">Entrenar</span>
                            </button>
                            <button onClick={() => setView(GAMES.RANKING)} className="text-slate-300 flex flex-col items-center gap-1.5 hover:text-indigo-400 transition-all hover:scale-110">
                                <Icon name="TrendingUp" size={28}/><span className="text-[10px] font-black tracking-widest uppercase">Ranking</span>
                            </button>
                            <button onClick={() => window.location.reload()} className="text-slate-300 flex flex-col items-center gap-1.5 hover:text-red-400 transition-all hover:scale-110">
                                <Icon name="LogOut" size={28}/><span className="text-[10px] font-black tracking-widest uppercase">Salir</span>
                            </button>
                        </nav>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
