<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain-Op | Entrenamiento EstratÃ©gico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .7; } }
        .lucide-icon-wrapper i { display: flex; align-items: center; justify-content: center; }
        .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- ADAPTADOR DE ICONOS ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
                    iconRef.current.innerHTML = `<i data-lucide="${kebabName}"></i>`;
                    window.lucide.createIcons({
                        attrs: { 'stroke-width': 2.5, width: size, height: size, class: className, stroke: 'currentColor' }
                    });
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="lucide-icon-wrapper inline-flex items-center justify-center"></span>;
        };

        const GAMES = { LOGIN: 'login', MENU: 'menu', CALCULO: 'calculo', ATENCION: 'atencion', MEMORIA: 'memoria', RANKING: 'ranking' };

        const App = () => {
            const [profile, setProfile] = useState(null);
            const [view, setView] = useState('loading');
            const [score, setScore] = useState(0);
            const [gameState, setGameState] = useState('idle');
            const [timeLeft, setTimeLeft] = useState(30);
            const [ranking, setRanking] = useState([
                { name: "Ana Milena", university: "Poli", totalPoints: 1250 },
                { name: "Carlos Perez", university: "USAM", totalPoints: 980 }
            ]);

            const [math, setMath] = useState({ q: '', isCorrect: true, displayA: 0 });
            const [attention, setAttention] = useState([]);
            const [sequence, setSequence] = useState([]);
            const [userSeq, setUserSeq] = useState([]);

            const memorySteps = [
                { id: 'MessageSquare', label: 'Saludo' },
                { id: 'Target', label: 'IndagaciÃ³n' },
                { id: 'Brain', label: 'EmpatÃ­a' },
                { id: 'Award', label: 'Propuesta' },
                { id: 'Check', label: 'Cierre' }
            ];

            // Carga inicial (Simulando base de datos local)
            useEffect(() => {
                const saved = localStorage.getItem('brainop_user');
                setTimeout(() => {
                    if (saved) {
                        setProfile(JSON.parse(saved));
                        setView(GAMES.MENU);
                    } else {
                        setView(GAMES.LOGIN);
                    }
                }, 1500);
            }, []);

            const handleRegister = (e) => {
                e.preventDefault();
                const data = {
                    name: e.target.name.value,
                    university: e.target.uni.value,
                    totalPoints: 0,
                    highScore: 0
                };
                localStorage.setItem('brainop_user', JSON.stringify(data));
                setProfile(data);
                setView(GAMES.MENU);
            };

            const saveScore = (finalScore) => {
                const newProfile = { ...profile };
                newProfile.totalPoints += finalScore;
                newProfile.highScore = Math.max(newProfile.highScore, finalScore);
                setProfile(newProfile);
                localStorage.setItem('brainop_user', JSON.stringify(newProfile));
            };

            // LÃ³gica de Juegos
            const genMath = useCallback(() => {
                const b = Math.floor(Math.random() * 9 + 1) * 100;
                const d = [10, 20, 25, 50][Math.floor(Math.random() * 4)];
                const c = b - (b * (d / 100));
                const corr = Math.random() > 0.5;
                setMath({ q: `$${b} con ${d}% Beca`, isCorrect: corr, displayA: corr ? c : c + 10 });
            }, []);

            const genAttention = useCallback(() => {
                const icons = ['GraduationCap', 'Target', 'Brain', 'Zap', 'Award'];
                const m = icons[Math.floor(Math.random() * icons.length)];
                let o = icons[Math.floor(Math.random() * icons.length)];
                while(o === m) o = icons[Math.floor(Math.random() * icons.length)];
                const p = Math.floor(Math.random() * 16);
                setAttention(Array(16).fill(null).map((_, i) => ({ id: i, icon: i === p ? o : m, isOdd: i === p })));
            }, []);

            const genSeq = useCallback(() => {
                const icons = ['MessageSquare', 'Target', 'Brain', 'Award', 'Check'];
                const s = Array(3).fill(null).map(() => icons[Math.floor(Math.random() * icons.length)]);
                setSequence(s);
                setUserSeq([]);
                setGameState('memorizing');
                setTimeout(() => setGameState('playing'), 2000);
            }, []);

            useEffect(() => {
                let t;
                if (gameState === 'playing' && timeLeft > 0) t = setInterval(() => setTimeLeft(p => p - 1), 1000);
                else if (timeLeft === 0 && gameState === 'playing') {
                    setGameState('finished');
                    saveScore(score);
                }
                return () => clearInterval(t);
            }, [gameState, timeLeft]);

            const start = (g) => {
                setScore(0); setTimeLeft(30); setView(g);
                if (g === GAMES.CALCULO) { setGameState('playing'); genMath(); }
                if (g === GAMES.ATENCION) { setGameState('playing'); genAttention(); }
                if (g === GAMES.MEMORIA) { genSeq(); }
            };

            // VISTAS
            if (view === 'loading') return (
                <div className="h-screen flex flex-col items-center justify-center bg-indigo-600 text-white">
                    <Icon name="Brain" size={64} className="animate-bounce mb-6" />
                    <p className="font-bold tracking-[0.2em] animate-pulse text-sm uppercase">Cargando Estrategia...</p>
                </div>
            );

            if (view === GAMES.LOGIN) return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-slate-50 text-slate-800">
                    <div className="w-full max-w-md bg-white p-10 rounded-[3rem] shadow-xl border border-indigo-50">
                        <div className="flex justify-center mb-8">
                            <div className="p-5 bg-indigo-600 rounded-3xl text-white shadow-xl shadow-indigo-100">
                                <Icon name="Brain" size={48} />
                            </div>
                        </div>
                        <h1 className="text-4xl font-black text-center mb-2 tracking-tight">Brain-Op</h1>
                        <p className="text-center text-slate-500 mb-10 text-sm font-medium">Entrena tu mente para liderar en USAM y Poli.</p>
                        <form onSubmit={handleRegister} className="space-y-5">
                            <input name="name" required className="w-full px-6 py-4 bg-slate-50 border-2 border-transparent focus:border-indigo-500 rounded-2xl outline-none font-semibold" placeholder="Tu Nombre" />
                            <select name="uni" className="w-full px-6 py-4 bg-slate-50 border-2 border-transparent focus:border-indigo-500 rounded-2xl outline-none font-semibold">
                                <option value="Poli">PolitÃ©cnico Grancolombiano</option>
                                <option value="USAM">Universidad San Marcos</option>
                            </select>
                            <button className="w-full py-5 bg-indigo-600 text-white rounded-2xl font-bold text-lg shadow-xl hover:bg-indigo-700 active:scale-95 transition-all">Empezar</button>
                        </form>
                    </div>
                </div>
            );

            return (
                <div className="max-w-md mx-auto min-h-screen bg-slate-50 flex flex-col shadow-2xl relative overflow-hidden text-slate-800">
                    {/* Header */}
                    <div className="bg-white/80 backdrop-blur-md p-5 border-b flex justify-between items-center sticky top-0 z-40">
                        <div className="flex items-center gap-3">
                            <div className="w-11 h-11 bg-indigo-600 rounded-2xl flex items-center justify-center text-white font-black text-xl">
                                {profile?.name?.[0]}
                            </div>
                            <div>
                                <p className="text-[10px] font-extrabold text-indigo-600 uppercase leading-none">{profile?.university}</p>
                                <p className="font-bold text-sm leading-tight truncate max-w-[140px]">{profile?.name}</p>
                            </div>
                        </div>
                        <div className="bg-amber-100 px-4 py-2 rounded-2xl border border-amber-200 flex items-center gap-2">
                            <Icon name="Zap" size={18} className="text-amber-500" />
                            <span className="font-black text-amber-700 text-sm">{profile?.totalPoints}</span>
                        </div>
                    </div>

                    <main className="flex-1 overflow-y-auto p-6 pb-28">
                        {view === GAMES.MENU && (
                            <div className="space-y-8">
                                <div className="bg-gradient-to-br from-indigo-600 to-indigo-800 p-8 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden">
                                    <h2 className="text-2xl font-bold mb-1 italic relative z-10">Â¡Hola!</h2>
                                    <p className="text-indigo-100 text-sm mb-8 font-medium relative z-10">Tu entrenamiento estÃ¡ listo.</p>
                                    <div className="flex gap-3 relative z-10">
                                        <div className="flex-1 glass-card p-4 rounded-3xl">
                                            <p className="text-[10px] uppercase font-black opacity-60 mb-1">RÃ©cord</p>
                                            <p className="font-black text-lg">{profile?.highScore} PTS</p>
                                        </div>
                                        <div className="flex-1 glass-card p-4 rounded-3xl">
                                            <p className="text-[10px] uppercase font-black opacity-60 mb-1">Estatus</p>
                                            <p className="font-black text-lg">Activo ðŸ”¥</p>
                                        </div>
                                    </div>
                                    <Icon name="Brain" size={150} className="absolute -right-10 -bottom-10 opacity-10" />
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <button onClick={() => start(GAMES.CALCULO)} className="p-6 bg-white rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all text-left group">
                                        <div className="w-12 h-12 bg-amber-50 text-amber-600 rounded-2xl flex items-center justify-center mb-4"><Icon name="Zap" size={24} /></div>
                                        <h4 className="font-extrabold text-sm mb-1">AuditorÃ­a</h4>
                                        <p className="text-[10px] text-slate-400 font-bold uppercase">CÃ¡lculos</p>
                                    </button>
                                    <button onClick={() => start(GAMES.ATENCION)} className="p-6 bg-white rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all text-left group">
                                        <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mb-4"><Icon name="Target" size={24} /></div>
                                        <h4 className="font-extrabold text-sm mb-1">Detalle</h4>
                                        <p className="text-[10px] text-slate-400 font-bold uppercase">AtenciÃ³n</p>
                                    </button>
                                    <button onClick={() => start(GAMES.MEMORIA)} className="p-6 bg-white rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all text-left group">
                                        <div className="w-12 h-12 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center mb-4"><Icon name="BookOpen" size={24} /></div>
                                        <h4 className="font-extrabold text-sm mb-1">Ruta Venta</h4>
                                        <p className="text-[10px] text-slate-400 font-bold uppercase">Memoria</p>
                                    </button>
                                    <button onClick={() => setView(GAMES.RANKING)} className="p-6 bg-white rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all text-left group">
                                        <div className="w-12 h-12 bg-green-50 text-green-600 rounded-2xl flex items-center justify-center mb-4"><Icon name="Users" size={24} /></div>
                                        <h4 className="font-extrabold text-sm mb-1">Ranking</h4>
                                        <p className="text-[10px] text-slate-400 font-bold uppercase">Top 10</p>
                                    </button>
                                </div>
                            </div>
                        )}

                        {view === GAMES.CALCULO && gameState === 'playing' && (
                            <div className="h-full flex flex-col text-center">
                                <div className="flex justify-between items-center mb-8 bg-white p-4 rounded-3xl shadow-sm">
                                    <button onClick={() => setView(GAMES.MENU)}><Icon name="X" className="text-slate-400" /></button>
                                    <span className="font-black">{score} PTS</span>
                                    <span className="bg-slate-800 text-white px-4 py-1 rounded-xl">{timeLeft}s</span>
                                </div>
                                <div className="bg-white p-12 rounded-[3rem] shadow-xl mb-10">
                                    <p className="text-[11px] text-slate-400 font-black uppercase mb-4 tracking-widest">Â¿CÃ¡lculo Correcto?</p>
                                    <h3 className="text-xl font-bold text-slate-600 mb-2">{math.q}</h3>
                                    <div className="text-6xl font-black text-indigo-600">${math.displayA}</div>
                                </div>
                                <div className="grid grid-cols-2 gap-6">
                                    <button onClick={() => { if(!math.isCorrect) setScore(s=>s+10); genMath(); }} className="py-8 bg-white text-red-500 rounded-[2rem] shadow-sm border-2 border-red-50 active:scale-95 transition-all flex justify-center"><Icon name="X" size={48} /></button>
                                    <button onClick={() => { if(math.isCorrect) setScore(s=>s+10); genMath(); }} className="py-8 bg-white text-green-500 rounded-[2rem] shadow-sm border-2 border-green-50 active:scale-95 transition-all flex justify-center"><Icon name="Check" size={48} /></button>
                                </div>
                            </div>
                        )}

                        {view === GAMES.RANKING && (
                            <div className="space-y-4">
                                <div className="flex items-center gap-4 mb-6">
                                    <button onClick={() => setView(GAMES.MENU)} className="p-3 bg-white rounded-2xl shadow-sm"><Icon name="ArrowLeft" /></button>
                                    <h2 className="font-black text-2xl">LÃ­deres</h2>
                                </div>
                                {ranking.map((p, i) => (
                                    <div key={i} className="flex items-center p-6 bg-white rounded-[2rem] shadow-sm border border-slate-50">
                                        <span className="w-10 font-black text-indigo-600">#{i+1}</span>
                                        <div className="flex-1">
                                            <p className="font-bold">{p.name}</p>
                                            <p className="text-[10px] font-black uppercase opacity-40">{p.university}</p>
                                        </div>
                                        <p className="font-black text-xl text-indigo-600">{p.totalPoints}</p>
                                    </div>
                                ))}
                            </div>
                        )}

                        {gameState === 'finished' && (
                            <div className="h-full flex flex-col items-center justify-center text-center">
                                <div className="p-10 bg-amber-100 text-amber-600 rounded-full mb-8"><Icon name="Trophy" size={80} /></div>
                                <h2 className="text-4xl font-black mb-3">Â¡Bien hecho!</h2>
                                <p className="text-slate-500 mb-10 text-lg">Sumaste <span className="text-indigo-600 font-black px-3 py-1 bg-indigo-50 rounded-xl">{score}</span> puntos.</p>
                                <button onClick={() => setView(GAMES.MENU)} className="w-full py-5 bg-indigo-600 text-white rounded-2xl font-bold text-xl shadow-xl active:scale-95 transition-all">Volver al Inicio</button>
                            </div>
                        )}
                    </main>

                    {view === GAMES.MENU && (
                        <nav className="absolute bottom-0 w-full bg-white border-t p-6 flex justify-around rounded-t-[2.5rem] shadow-2xl">
                            <button className="text-indigo-600 flex flex-col items-center gap-1"><Icon name="Brain" size={24}/><span className="text-[9px] font-black uppercase">Entrenar</span></button>
                            <button onClick={() => setView(GAMES.RANKING)} className="text-slate-300 flex flex-col items-center gap-1"><Icon name="TrendingUp" size={24}/><span className="text-[9px] font-black uppercase">Ranking</span></button>
                            <button onClick={() => { localStorage.clear(); window.location.reload(); }} className="text-slate-300 flex flex-col items-center gap-1"><Icon name="LogOut" size={24}/><span className="text-[9px] font-black uppercase">Salir</span></button>
                        </nav>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
